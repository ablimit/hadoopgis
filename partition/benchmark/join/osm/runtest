#! /bin/bash

#if [ ! $# == 1 ]; then
    # echo "Usage: $0 [desktop | cluster | imac]"
    # exit
#fi

dir=testdir

if [ -e ${dir}/osm.rtree.sample.txt.gz ] && [ -e ${dir}/osm.rtree.sample.txt.gz ] 
then
    echo "All testing infrastructure is present."
else 
    echo "Test cases are missing... Can't do test without them."
    exit 1
fi

# create the test files.
make -f Makefile

# test 1 
echo -n "TEST: Map --- "

zcat ${dir}/osm.rtree.sample.txt.gz | ./mapper | gzip > ${dir}/map.mr.gz

# diff ${dir}/map.planet.db ${dir}/map.planet.mr >/dev/null 2>&1

if [ $? -ne 0 ]
then
    echo "failed."
else
    echo "passed."
    # cp ${dir}/map.mr.gz  > ${dir}/reduce.in.gz
fi

# test 2

echo -n "TEST: Reduce --- "


zcat ${dir}/map.mr.gz | ./reducer > ${dir}/result.txt

# /tmp/serr.txt | cut -f2 | sort -n > ${dir}/reduce.out.mr

# diff ${dir}/reduce.out.db ${dir}/reduce.out.mr >/dev/null 2>&1

if [ $? -ne 0 ]
then
    echo "failed."
else
    echo "passed."
fi

make clean

